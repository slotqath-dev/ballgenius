<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QA BallGenius - โปรแกรมวันนี้</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
*{box-sizing:border-box;font-family:sans-serif}
body{
  margin:0;
  background:#000;
  color:#fff;
}

/* HEADER */
header{
  padding:14px;
  background:#000;
  border-bottom:2px solid #e60000;
}
.logo{
  font-size:22px;
  font-weight:900;
}
.logo span{color:#e60000}

/* LEAGUE BAR */
.leagues{
  display:flex;
  gap:10px;
  padding:10px;
  overflow-x:auto;
}
.league{
  min-width:90px;
  padding:6px 10px;
  border-radius:12px;
  background:#111;
  font-size:12px;
  text-align:center;
  cursor:pointer;
  border:1px solid #222;
}
.league.active{
  border-color:#e60000;
  color:#e60000;
}

/* CONTENT */
.content{padding:12px;padding-bottom:80px}
.match{
  background:#111;
  border-radius:14px;
  padding:12px;
  margin-bottom:10px;
}
.teams{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.team{
  width:45%;
  text-align:center;
  font-size:13px;
}
.vs{
  color:#e60000;
  font-weight:700;
  font-size:14px;
}
.time{
  margin-top:6px;
  font-size:11px;
  color:#aaa;
  text-align:center;
}

/* BOTTOM */
.bottom{
  position:fixed;
  bottom:0;left:0;right:0;
  display:flex;
  background:#000;
  border-top:2px solid #e60000;
}
.tab{
  flex:1;
  padding:10px 0;
  text-align:center;
  font-size:12px;
  color:#aaa;
}
.tab.active{color:#e60000;font-weight:700}
</style>
</head>

<body>

<header>
  <div class="logo"><span>QA</span> BallGenius</div>
</header>

<!-- ลีก (กรองจากข้อมูลจริง) -->
<div class="leagues" id="leagueBar"></div>

<!-- โปรแกรมวันนี้ -->
<div class="content" id="matches">
  <div style="color:#aaa;font-size:13px">กำลังโหลดโปรแกรมวันนี้…</div>
</div>

<div class="bottom">
  <div class="tab active">วันนี้</div>
  <div class="tab">สด</div>
  <div class="tab">ลีก</div>
  <div class="tab">เพิ่มเติม</div>
</div>

<script>
Telegram.WebApp.ready();
Telegram.WebApp.expand();

/* API ฟรี ไม่ต้อง KEY */
const API = "https://www.scorebat.com/video-api/v3/";

let allMatches = [];
let currentLeague = "ALL";

fetch(API)
.then(res=>res.json())
.then(data=>{
  allMatches = data.response;
  buildLeagues();
  renderMatches();
})
.catch(()=>{
  document.getElementById("matches").innerHTML =
    "<div style='color:#f66'>โหลดข้อมูลไม่สำเร็จ</div>";
});

/* สร้างรายชื่อลีกจากข้อมูลจริง */
function buildLeagues(){
  const leagues = [...new Set(allMatches.map(m=>m.competition))];
  const bar = document.getElementById("leagueBar");

  bar.innerHTML = `<div class="league active" data-lg="ALL">ทั้งหมด</div>`;

  leagues.forEach(lg=>{
    bar.innerHTML += `<div class="league" data-lg="${lg}">${lg}</div>`;
  });

  document.querySelectorAll(".league").forEach(l=>{
    l.onclick=()=>{
      document.querySelectorAll(".league").forEach(x=>x.classList.remove("active"));
      l.classList.add("active");
      currentLeague = l.dataset.lg;
      renderMatches();
    };
  });
}

/* แสดงแมตช์วันนี้ */
function renderMatches(){
  const box = document.getElementById("matches");
  box.innerHTML = "";

  const today = new Date().toDateString();

  const list = allMatches.filter(m=>{
    const d = new Date(m.date).toDateString();
    return d===today && (currentLeague==="ALL" || m.competition===currentLeague);
  });

  if(list.length===0){
    box.innerHTML = "<div style='color:#aaa'>วันนี้ไม่มีโปรแกรม</div>";
    return;
  }

  list.forEach(m=>{
    box.innerHTML += `
      <div class="match">
        <div class="teams">
          <div class="team">${m.side1.name}</div>
          <div class="vs">VS</div>
          <div class="team">${m.side2.name}</div>
        </div>
        <div class="time">${new Date(m.date).toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit"})}</div>
      </div>
    `;
  });
}
</script>

</body>
</html>
